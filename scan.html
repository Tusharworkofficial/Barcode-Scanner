<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan Barcode</title>
    <style>
        :root {
            --primary-color: #8F0524;
            --secondary-color: #f5f5f5;
            --background-color: #576363;
            --text-color: #333333;
            --accent-color: #8F0524;
            --button-hover-color: #4A0714;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --background-colors: #f5f5f5;
            --highlight-color: #FCC5A8;
            /* New color for navbar text and buttons */
        }

        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }







        nav {
            height: 60px;
            background-color: var(--color-1);
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .links-container {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        nav a {
            height: 100%;
            padding: 0 20px;
            display: flex;
            align-items: center;
            text-decoration: none;
            color: #ffffff;

        }

        nav a:hover {
            background-color: #FCC5A8;
            border: 2px solid #ff9900;
            box-shadow: rgb(38, 57, 77) 0px 20px 30px -10px;
            color: rgb(22, 159, 168);

        }

        nav .home-link {
            margin-right: auto;

        }

        nav .a {
            border-bottom: 1px solid white;

        }

        nav svg {
            fill: var(--text-color);
            border: 1px solid white;
        }

        #sidebar-active {
            display: none;
        }

        .open-sidebar-button,
        .close-sidebar-button {
            display: none;

        }

        @media(max-width: 450px) {
            .links-container {
                flex-direction: column;
                align-items: flex-start;
                border-bottom: 100px solid white;
                position: fixed;
                top: 0;
                right: -100%;
                z-index: 10;
                width: 300px;

                background-color: var(--primary-color);



                
                box-shadow: -5px 0 5px rgba(0, 0, 0, 0.25);
                transition: 0.75s ease-out;
            }

            nav a {
                box-sizing: border-box;
                height: auto;
                width: 100%;
                padding: 20px 30px;
                justify-content: flex-start;
                border-bottom: 1px solid white;
            }

            nav .home-link {
                border-top: 1px solid white;
            }

            .open-sidebar-button,
            .close-sidebar-button {
                padding: 32px;
                display: block;
                padding-top: 37px;
            }

            #sidebar-active:checked~.links-container {
                right: 0;
            }

            #sidebar-active:checked~#overlay {
                height: 100%;
                width: 100%;
                position: fixed;
                top: 0;
                left: 0;
                z-index: 9;
            }
        }

        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        header {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            padding: 1.5rem 4rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            padding-left: 2px;
        }


        @media (min-width: 1024px) {
            header {
                padding: 1.5rem 4rem;
            }

            main {
                padding: 2rem 4rem;
            }
        }

        .nav-logo {
            font-size: 1.8rem;
            color: var(--highlight-color);
            font-weight: bold;
            text-decoration: none;
        }

        nav ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        nav ul li {
            position: relative;
        }

        nav ul li a {
            color: var(--highlight-color);
            text-decoration: none;
            font-weight: bold;
        }

        nav ul li a:hover {
            text-decoration: underline;
        }

        nav ul li .dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: var(--primary-color);
            box-shadow: 0 4px 6px var(--shadow-color);
            border-radius: 4px;
            z-index: 1000;
            padding: 0.5rem 0;
        }

        nav ul li:hover .dropdown {
            display: block;
        }

        nav ul li .dropdown a {
            display: block;
            padding: 0.5rem 1rem;
            white-space: nowrap;
        }

        nav ul li .dropdown a:hover {
            background-color: var(--button-hover-color);
        }

        main {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            padding-left: 10px;
            padding-right: 10px;
        }

        footer {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            text-align: center;
            padding: 1.5rem;
            margin-top: 3rem;
        }
















        main {
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .scanner-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background-color: white;
            border-radius: 10px;
            flex-wrap: wrap;
            padding: 30px;
        }

        .scanner-container input {
            padding: 0.75rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            
        }

        .scanner-container button {
            padding: 0.75rem;
            font-size: 1rem;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .scanner-container button:hover {
            background-color: var(--button-hover-color);
        }

        .result-container {
            padding: 1rem;
            background-color: var(--secondary-color);
            color: black;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table,
        th,
        td {
            border: 1px solid #ccc;
        }

        th,
        td {
            padding: 0.75rem;
            text-align: left;
        }

        th {
            background-color: var(--primary-color);
            color: var(--secondary-color);
        }

        td {
            background-color: #f5f5f5;
        }





        .slider-container {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 8px rgba(245, 244, 244, 0.2);
            margin-top: 2rem;
        }

        .slider-block {
            flex: 1 1 45%;
            background-color: var(--secondary-color);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-wrap: wrap;
            box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
        }

        .slider-block:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .slider-container h3 {
            color: var(--primary-color);
            font-size: 1.25rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .slider-container label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .slider-container input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 1rem;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .slider-container input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .slider-container button {
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .slider-container button:hover {
            background-color: var(--button-hover-color);
        }

        .slider-container>div {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            justify-content: center;
            align-items: flex-start;
        }

        #add-quantity-form {
            display: flex;
            flex-wrap: wrap;
        }

        #deduct-quantity-form {
            display: flex;
            flex-wrap: wrap;
        }


        .slider-block {
            display: none;
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <input type="checkbox" id="sidebar-active">
            <label for="sidebar-active" class="open-sidebar-button">
                <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 -960 960 960" width="32">
                    <path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z" />
                </svg>
            </label>
            <label id="overlay" for="sidebar-active"></label>
            <div class="links-container">
                <label for="sidebar-active" class="close-sidebar-button">
                    <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 -960 960 960" width="32">
                        <path
                            d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z" />
                    </svg>
                </label>

                <!-- NOT IN TUTORIAL: The <a> tags are linked to the subpages -->
                <a class="home-link" href="index.html">Generate barcode</a>
                <a href="scan.html">Scan Barcode</a>
                <a href="database.html">DataBase</a>
                <a href="deducted_barcode_data.html">Deducted DataBase</a>

            </div>
        </nav>
    </header>

    <main>
        <div class="scanner-container">
            <h2>Scan Barcode</h2>
            <label for="barcode-input">Scan or Enter Barcode ID:</label>
            <input type="text" id="barcode-input" placeholder="Scan barcode here..." />
            <button id="fetch-data">Fetch Data</button>
        </div>
        <div class="result-container" id="result-container" style="display: none;">
            <h3>Barcode Details</h3>
            <table>
                <thead>
                    <tr>
                        <th>Material ID</th>
                        <th>Material Name</th>
                        <th>Quantity</th>
                        <th>unit</th>
                        <th>Expiry Date</th>
                        <th>Supplier Details</th>
                        <th>Category</th>
                        <th>Batch</th>
                        <th>Cost Per Unit</th>
                        <th>Time Stamp</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="result-table-body">
                </tbody>
            </table>
        </div>




        <div class="slider-container">


            <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 1rem;">
                <h2>Edit Quantity</h2>
                <button id="show-add-form"
                    style="padding: 0.75rem; background-color: var(--primary-color); color: var(--secondary-color); border: none; border-radius: 5px; cursor: pointer;">
                    Add Quantity
                </button>
                <button id="show-deduct-form"
                    style="padding: 0.75rem; background-color: var(--primary-color); color: var(--secondary-color); border: none; border-radius: 5px; cursor: pointer;">
                    Deduct Quantity
                </button>
            </div>

            <div style="display: flex; gap: 2rem; overflow-x: auto; padding: 1rem;">
                <!-- Add Quantity Form -->
                <div class="slider-block"
                    style="flex: 0 0 95%; background: var(--secondary-color); padding: 1rem; border-radius: 5px;">
                    <h3>Add Quantity</h3>
                    <form id="add-quantity-form">
                        <label for="add-barcode">Barcode ID:</label>
                        <input type="text" id="add-barcode" placeholder="Enter barcode ID" required>
                        <label for="add-quantity">Quantity to Add:</label>
                        <input type="number" id="add-quantity" placeholder="Enter quantity to add" required>
                        <button type="submit">Add Quantity</button>
                    </form>
                </div>

                <!-- Deduct Quantity Form -->
                <div class="slider-block"
                    style="flex: 0 0 95%; background: var(--secondary-color); padding: 1rem; border-radius: 5px;">
                    <h3>Deduct Quantity</h3>
                    <form id="deduct-quantity-form">
                        <label for="deduct-barcode">Barcode ID:</label>
                        <input type="text" id="deduct-barcode" placeholder="Enter barcode ID" required>
                        <label for="deduct-quantity">Quantity to Deduct:</label>
                        <input type="number" id="deduct-quantity" placeholder="Enter quantity to deduct" required>
                        <button type="submit">Deduct Quantity</button>
                    </form>
                </div>
            </div>
        </div>


    </main>

    <script>
        const barcodeInput = document.getElementById('barcode-input');
        const fetchDataButton = document.getElementById('fetch-data');
        const resultContainer = document.getElementById('result-container');
        const resultTableBody = document.getElementById('result-table-body');

        // Fetch the database stored in localStorage (or modify as necessary to fetch from the real DB)
        const fetchDatabase = () => {
            const database = JSON.parse(localStorage.getItem('barcodeDatabase')) || [];
            return database;
        };

        // Fetch the data of a specific barcode
        const fetchBarcodeData = (barcode) => {
            const database = fetchDatabase();
            return database.find(entry => entry.barcode === barcode);
        };

        // Display the result
        const displayResult = (data) => {
            if (!data) {
                alert('No data found for this barcode.');
                return;
            }

            resultTableBody.innerHTML = ` 
                <tr>
                    <td>${data.materialId}</td>
                    <td>${data.materialName}</td>
                    <td>${data.quantity}</td>
                    <td>${data.unit}</td>
                    <td>${data.expiryDate}</td>
                    <td>${data.supplierDetails}</td>
                    <td>${data.category}</td>
                    <td>${data.batch}</td>
                    <td>${data.costPerUnit}</td>
                    <td>${new Date(data.timestamp).toLocaleString()}</td>
                </tr>
            `;

            resultContainer.style.display = 'block';
        };

        fetchDataButton.addEventListener('click', async () => {
            const barcode = barcodeInput.value.trim();

            if (!barcode) {
                alert('Please enter or scan a barcode.');
                return;
            }

            const data = fetchBarcodeData(barcode);
            displayResult(data);
        });

        // Automatically trigger fetch when Enter is pressed (useful for barcode scanners)
        barcodeInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                fetchDataButton.click();
            }
        });






        // Update database with added quantity
        document.getElementById('add-quantity-form').addEventListener('submit', (event) => {
            event.preventDefault();

            const barcode = document.getElementById('add-barcode').value.trim();
            const quantityToAdd = parseInt(document.getElementById('add-quantity').value.trim(), 10);

            if (!barcode || isNaN(quantityToAdd) || quantityToAdd <= 0) {
                alert('Please provide valid input.');
                return;
            }

            const database = fetchDatabase();
            const entry = database.find(item => item.barcode === barcode);

            if (entry) {
                entry.quantity = Number(entry.quantity) + Number(quantityToAdd);
                localStorage.setItem('barcodeDatabase', JSON.stringify(database));
                alert('Quantity successfully added.');
            } else {
                alert('No entry found for this barcode.');
            }

            event.target.reset();
        });

        // Update database with deducted quantity
        document.getElementById('deduct-quantity-form').addEventListener('submit', (event) => {
            event.preventDefault();

            const barcode = document.getElementById('deduct-barcode').value.trim();
            const quantityToDeduct = parseInt(document.getElementById('deduct-quantity').value.trim(), 10);

            if (!barcode || isNaN(quantityToDeduct) || quantityToDeduct <= 0) {
                alert('Please provide valid input.');
                return;
            }

            const database = fetchDatabase();
            const entry = database.find(item => item.barcode === barcode);

            if (entry) {
                if (entry.quantity >= quantityToDeduct) {
                    entry.quantity -= quantityToDeduct;
                    localStorage.setItem('barcodeDatabase', JSON.stringify(database));
                    alert('Quantity successfully deducted.');
                } else {
                    alert('Insufficient quantity to deduct.');
                }
            } else {
                alert('No entry found for this barcode.');
            }

            event.target.reset();
        });

        // this is ------------------------------------------------------------------------------


        // Update database with added quantity
        document.getElementById('add-quantity-form').addEventListener('submit', (event) => {
            event.preventDefault();

            const barcode = document.getElementById('add-barcode').value.trim();
            const quantityToAdd = parseInt(document.getElementById('add-quantity').value.trim(), 10);

            if (!barcode || isNaN(quantityToAdd) || quantityToAdd <= 0) {
                alert('Please provide valid input.');
                return;
            }

            const database = fetchDatabase();
            const entry = database.find(item => item.barcode === barcode);

            if (entry) {
                entry.quantity = Number(entry.quantity) + Number(quantityToAdd); // Ensure both are numbers before adding
                localStorage.setItem('barcodeDatabase', JSON.stringify(database));
                alert('Quantity successfully added.');
                // Update the result table to show the new quantity
                displayResult(entry);
            } else {
                alert('No entry found for this barcode.');
            }

            event.target.reset();
        });

        // Update database with deducted quantity
        document.getElementById('deduct-quantity-form').addEventListener('submit', (event) => {
            event.preventDefault();

            const barcode = document.getElementById('deduct-barcode').value.trim();
            const quantityToDeduct = parseInt(document.getElementById('deduct-quantity').value.trim(), 10);

            if (!barcode || isNaN(quantityToDeduct) || quantityToDeduct <= 0) {
                alert('Please provide valid input.');
                return;
            }

            const database = fetchDatabase();
            const entry = database.find(item => item.barcode === barcode);

            if (entry) {
                if (entry.quantity >= quantityToDeduct) {
                    entry.quantity = Number(entry.quantity) - quantityToDeduct; // Ensure both are numbers before subtracting
                    localStorage.setItem('barcodeDatabase', JSON.stringify(database));
                    alert('Quantity successfully deducted.');
                    // Update the result table to show the new quantity
                    displayResult(entry);
                } else {
                    alert('Insufficient quantity to deduct.');
                }
            } else {
                alert('No entry found for this barcode.');
            }

            event.target.reset();
        });







        const addForm = document.querySelector('#add-quantity-form').parentElement;
        const deductForm = document.querySelector('#deduct-quantity-form').parentElement;

        const showAddFormButton = document.getElementById('show-add-form');
        const showDeductFormButton = document.getElementById('show-deduct-form');

        // Show Add Quantity form and hide Deduct Quantity form
        showAddFormButton.addEventListener('click', () => {
            addForm.style.display = 'block';
            deductForm.style.display = 'none';
        });

        // Show Deduct Quantity form and hide Add Quantity form
        showDeductFormButton.addEventListener('click', () => {
            deductForm.style.display = 'block';
            addForm.style.display = 'none';
        });

        // Optionally, display the "Add Quantity" form by default
        addForm.style.display = 'block';









        // Get references to the form elements
        const barcodeForm = document.getElementById('barcode-form');
        
        const productIdInput = document.getElementById('product-id');
        const productNameInput = document.getElementById('product-name');
        const addedQuantityInput = document.getElementById('added-quantity');
        const deductedQuantityInput = document.getElementById('deducted-quantity');
        const amountDeductedInput = document.getElementById('amount-deducted');
        const message = document.getElementById('message');

        // Function to get stored data from localStorage
        const getStoredData = () => {
            return JSON.parse(localStorage.getItem('barcodeData')) || [];
        };

        // Function to save data to localStorage
        const saveDataToStorage = (data) => {
            localStorage.setItem('barcodeData', JSON.stringify(data));
        };

        // Handle form submission
        barcodeForm.addEventListener('submit', (event) => {
            event.preventDefault();

            const barcode = barcodeInput.value.trim();
            const productId = productIdInput.value.trim();
            const productName = productNameInput.value.trim();
            const addedQuantity = parseInt(addedQuantityInput.value, 10);
            const deductedQuantity = parseInt(deductedQuantityInput.value, 10);
            const amountDeducted = parseFloat(amountDeductedInput.value);

            if (barcode && productId && productName && addedQuantity >= 0 && deductedQuantity >= 0 && amountDeducted >= 0) {
                // Get the current data from localStorage
                let data = getStoredData();

                // Create a new entry for this barcode scan
                const newEntry = {
                    barcode: barcode,
                    productId: productId,
                    productName: productName,
                    addedQuantity: addedQuantity,
                    deductedQuantity: deductedQuantity,
                    amountDeducted: amountDeducted,
                    timestamp: new Date().toISOString() // Store the current timestamp
                };

                // Add the new entry to the existing data array
                data.push(newEntry);

                // Save the updated data back to localStorage
                saveDataToStorage(data);

                // Display success message
                message.textContent = 'Barcode data saved successfully!';
                message.style.color = 'green';

                // Clear the form after submission
                barcodeForm.reset();
            } else {
                // Display error message if validation fails
                message.textContent = 'Please fill in all fields correctly.';
                message.style.color = 'red';
            }
        });




    </script>
</body>

</html>